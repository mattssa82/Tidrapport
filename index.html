<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tidrapport v10.18</title>

  <!-- PWA / tema -->
  <meta name="theme-color" content="#0e6677" />
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icons/icon-192.png" />

  <!-- Lucide ikoner -->
  <script src="lucide.min.js"></script>

  <!--
    Tidrapport v10.18
    I samarbete med ChatGPT & Martin Mattsson
  -->

  <style>
    :root{
      --bg-main:#f5f7f8;
      --bg-header:#0e6677;
      --bg-card:#ffffff;
      --text-main:#1a1a1a;
      --border-col:#cfcfcf;
      --danger:#c0392b;
      --accent:#0e6677;
    }

    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
      background:var(--bg-main);
      color:var(--text-main);
    }

    /* HEADER */
    header.app-header{
      position:sticky;
      top:0;
      z-index:50;
      background:var(--bg-header);
      color:#fff;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:.6rem 1rem;
      box-shadow:0 2px 4px rgba(0,0,0,.18);
    }
    .header-left{
      display:flex;
      align-items:center;
      gap:.5rem;
    }
    .header-left h1{
      margin:0;
      font-size:1.1rem;
      font-weight:600;
    }
    .icon-btn{
      background:transparent;
      border:0;
      color:#fff;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:.25rem;
      cursor:pointer;
    }
    .header-actions{
      display:flex;
      gap:.4rem;
      align-items:center;
    }
    .header-link-btn{
      display:inline-flex;
      align-items:center;
      gap:.25rem;
      padding:.25rem .5rem;
      border-radius:.4rem;
      border:0;
      background:rgba(255,255,255,.08);
      color:#fff;
      font-size:.75rem;
      text-decoration:none;
      cursor:pointer;
    }
    .header-link-btn:hover{
      background:rgba(255,255,255,.18);
    }

    /* LAYOUT */
    .layout{
      display:flex;
      min-height:calc(100vh - 52px);
    }

    /* SIDOPANEL */
    #sidePanel{
      position:fixed;
      inset:0 auto 0 0;
      width:260px;
      max-width:80%;
      background:var(--bg-header);
      color:#fff;
      padding:1rem;
      transform:translateX(-100%);
      transition:transform .2s ease;
      z-index:100;
      box-shadow:2px 0 10px rgba(0,0,0,.45);
    }
    #sidePanel.open{
      transform:translateX(0);
    }
    #sidePanel h2{
      font-size:.85rem;
      font-weight:600;
      margin:1rem 0 .5rem;
    }
    #sidePanel label{
      display:block;
      font-size:.75rem;
      margin-bottom:.35rem;
    }
    #sidePanel input,
    #sidePanel select,
    #sidePanel textarea{
      width:100%;
      font-size:.8rem;
      padding:.35rem .45rem;
      border-radius:.3rem;
      border:1px solid rgba(255,255,255,.35);
      background:rgba(255,255,255,.12);
      color:#fff;
    }
    #sidePanel textarea{
      resize:vertical;
      min-height:2.4rem;
    }
    .side-buttons{
      display:grid;
      gap:.4rem;
      margin-top:.4rem;
    }
    .side-action{
      display:flex;
      align-items:center;
      gap:.35rem;
      padding:.4rem .5rem;
      border:0;
      border-radius:.35rem;
      font-size:.8rem;
      font-weight:500;
      cursor:pointer;
      background:#fff;
      color:var(--accent);
      text-align:left;
    }
    .side-action.danger{
      background:var(--danger);
      color:#fff;
    }
    .bool-row{
      display:flex;
      align-items:center;
      gap:.4rem;
      font-size:.75rem;
      margin:.2rem 0;
    }
    .bool-row input[type="checkbox"]{
      width:1.2rem;
      height:1.2rem;
      accent-color:#fff;
      cursor:pointer;
    }
    .side-footnote{
      font-size:.65rem;
      opacity:.78;
      margin-top:.75rem;
      line-height:1.4;
    }

    main#mainArea{
      flex:1;
      padding:1rem;
      margin-left:0;
    }

    /* ENTRY CARD */
    .entry-card{
      background:var(--bg-card);
      border:1px solid var(--border-col);
      border-radius:.6rem;
      padding:.9rem;
      margin-bottom:1rem;
      box-shadow:0 2px 4px rgba(0,0,0,.06);
    }
    .entry-grid{
      display:grid;
      grid-template-columns:repeat(2,minmax(140px,1fr));
      gap:.6rem .8rem;
      align-items:flex-end;
    }
    .entry-grid label{
      font-size:.75rem;
      font-weight:500;
      color:#444;
      display:flex;
      flex-direction:column;
      gap:.25rem;
    }
    .entry-grid input,
    .entry-grid select,
    .entry-grid textarea{
      font-size:.85rem;
      padding:.4rem .5rem;
      border-radius:.35rem;
      border:1px solid #bbb;
      background:#fff;
      color:#000;
    }
    .entry-grid textarea{
      grid-column:1/-1;
      min-height:2.5rem;
      resize:vertical;
    }
    .full-width{
      grid-column:1/-1;
    }
    .cat-row{
      display:flex;
      gap:.35rem;
      align-items:center;
    }
    .cat-row select{
      flex:1.6;
    }
    .cat-row input{
      flex:.9;
      text-align:right;
    }

    .button-row{
      margin-top:.6rem;
      display:flex;
      flex-wrap:wrap;
      gap:.45rem;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      gap:.3rem;
      padding:.45rem .7rem;
      border-radius:.45rem;
      border:0;
      font-size:.8rem;
      font-weight:500;
      cursor:pointer;
      background:var(--accent);
      color:#fff;
    }
    .btn.secondary{
      background:#888;
    }
    .btn.danger{
      background:var(--danger);
    }

    /* TABELL */
    .table-wrap{
      background:var(--bg-card);
      border:1px solid var(--border-col);
      border-radius:.6rem;
      box-shadow:0 2px 4px rgba(0,0,0,.05);
      overflow-x:auto;
      margin-bottom:1rem;
    }
    table{
      border-collapse:collapse;
      width:100%;
      min-width:780px;
      font-size:.75rem;
    }
    thead th{
      background:#ececec;
      padding:.4rem .5rem;
      text-align:left;
      font-weight:600;
      border-bottom:1px solid var(--border-col);
      white-space:nowrap;
    }
    tbody td{
      padding:.35rem .5rem;
      border-top:1px solid var(--border-col);
      vertical-align:top;
      word-break:break-word;
    }
    tfoot td{
      padding:.4rem .5rem;
      border-top:2px solid var(--border-col);
      background:#fafafa;
      font-weight:600;
    }
    .icon-table-btn{
      background:none;
      border:0;
      padding:.2rem;
      border-radius:.3rem;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
    }
    .icon-table-btn.edit{
      color:var(--accent);
    }
    .icon-table-btn.del{
      color:var(--danger);
    }

    /* DAGFÄRGER (balans) */
    .day-ok{background:#dff8dd;}
    .day-under{background:#fff2cc;}
    .day-miss{background:#ffd6d6;}
    .day-free{background:#eef3ff;}
    .day-red{background:#ffe6e6;}

    /* LARM / OBALANS */
    .alarm-card{
      background:var(--bg-card);
      border:1px solid var(--border-col);
      border-radius:.6rem;
      box-shadow:0 2px 4px rgba(0,0,0,.05);
      padding:.7rem;
      margin-bottom:1.2rem;
    }
    .alarm-card h3{
      font-size:.85rem;
      margin:.1rem 0 .4rem;
      display:flex;
      align-items:center;
      gap:.35rem;
      color:#b03a2e;
    }
    .alarm-empty{
      font-size:.75rem;
      color:#555;
    }

    /* ÅRSÖVERSIKT */
    .year-card{
      background:var(--bg-card);
      border:1px solid var(--border-col);
      border-radius:.6rem;
      box-shadow:0 2px 4px rgba(0,0,0,.05);
      padding:.8rem;
      margin-bottom:1.5rem;
      overflow-x:auto;
    }
    .year-card h3{
      font-size:.85rem;
      margin:0 0 .4rem;
      color:#222;
    }

    /* POPUP */
    #warnPopup{
      position:fixed;
      left:50%;
      bottom:1.2rem;
      transform:translateX(-50%);
      max-width:90%;
      background:#fff3cd;
      color:#7a5b00;
      border:1px solid #ffe08a;
      padding:.5rem .7rem;
      border-radius:.5rem;
      box-shadow:0 2px 8px rgba(0,0,0,.22);
      font-size:.75rem;
      display:none;
      z-index:9999;
      display:none;
    }
    #warnPopup strong{
      margin-right:.3rem;
    }

    /* RESPONSIVE */
    @media (min-width:900px){
      /* panel styrs av JS via .open */
      main#mainArea{
        padding:1.2rem 1.5rem 1.5rem;
      }
    }

  </style>
</head>

<body>
<header class="app-header">
  <div class="header-left">
    <button class="icon-btn" id="menuToggleBtn" aria-label="Meny" aria-expanded="false">
      <i data-lucide="menu"></i>
    </button>
    <h1>Tidrapport</h1>
  </div>
  <div class="header-actions">
    <a href="search.html" class="header-link-btn">
      <i data-lucide="search"></i><span>Sök</span>
    </a>
    <a href="help.html" class="header-link-btn">
      <i data-lucide="info"></i><span>Hjälp</span>
    </a>
  </div>
</header>

<div class="layout">
  <!-- SIDOPANEL -->
  <aside id="sidePanel" aria-hidden="true">
    <h2>Period</h2>
    <label>År
      <select id="yearSelect"></select>
    </label>
    <label>Månad
      <select id="monthSelect"></select>
    </label>

    <h2>Backup / Import / Export</h2>
    <div class="side-buttons">
      <input type="file" id="importFileInput" accept=".json" />

      <button class="side-action" id="manualBackupBtn">
        <i data-lucide="upload-cloud"></i>
        <span>Backup nu (JSON)</span>
      </button>

      <button class="side-action" id="exportCsvBtn">
        <i data-lucide="file-spreadsheet"></i>
        <span>Exportera månad (CSV)</span>
      </button>

      <button class="side-action" id="exportPdfBtn">
        <i data-lucide="file-text"></i>
        <span>Exportera månad (PDF)</span>
      </button>

      <button class="side-action" id="exportYearBtn">
        <i data-lucide="calendar"></i>
        <span>Exportera årsöversikt (CSV)</span>
      </button>

      <button class="side-action" id="clearAllBtn">
        <i data-lucide="trash-2"></i>
        <span>RENSA ALL DATA</span>
      </button>
    </div>

    <h2>Inställningar</h2>

    <label>Företag
      <input id="companyInput" type="text" />
    </label>
    <label>Namn
      <input id="nameInput" type="text" />
    </label>
    <label>Anst.nr
      <input id="anstnrInput" type="text" />
    </label>

    <label>Röda dagar (YYYY-MM-DD, kommatecken)
      <textarea id="redDaysInput" placeholder="2025-06-06, 2025-12-26"></textarea>
    </label>
    <label>Standard röddag (h)
      <input id="redDayHoursInput" type="text" placeholder="8" />
    </label>

    <div class="bool-row">
      <input id="showRedDaysChk" type="checkbox" />
      <span>Visa röda dagar / undanta från larm</span>
    </div>
    <div class="bool-row">
      <input id="autoBackupChk" type="checkbox" />
      <span>Auto-backup (vid ändring)</span>
    </div>

    <button class="side-action" id="saveSettingsBtn">
      <i data-lucide="save"></i>
      <span>Spara inställningar</span>
    </button>

    <div class="side-footnote">
      Tidrapport v10.18<br/>
      I samarbete med ChatGPT &amp; Martin Mattsson
    </div>
  </aside>

  <!-- HUVUDINNEHÅLL -->
  <main id="mainArea">

    <!-- INMATNING -->
    <section class="entry-card">
      <div class="entry-grid">
        <!-- Rad 1: Datum -->
        <label class="full-width">Datum
          <input id="dateInput" type="date" />
        </label>

        <!-- Rad 2: Projekt & Körtid -->
        <label>Projekt nr
          <input id="projektInput" type="text" />
        </label>
        <label>Körtid (h)
          <!-- text för att tillåta minus och komma; parsas i JS -->
          <input id="driveHoursInput" type="text" inputmode="decimal" />
        </label>

        <!-- Rad 3: Kategori 1 (obligatorisk rad) -->
        <label class="full-width">Kategori 1
          <div class="cat-row">
            <select id="catMainSelect"></select>
            <input id="catMainHours" type="text" inputmode="decimal" placeholder="timmar" />
          </div>
        </label>

        <!-- Rad 4: Extra kategori 2 -->
        <label class="full-width">Extra kategori 2
          <div class="cat-row">
            <select id="catExtraSelect1"></select>
            <input id="catExtraHours1" type="text" inputmode="decimal" placeholder="timmar" />
          </div>
        </label>

        <!-- Rad 5: Extra kategori 3 -->
        <label class="full-width">Extra kategori 3
          <div class="cat-row">
            <select id="catExtraSelect2"></select>
            <input id="catExtraHours2" type="text" inputmode="decimal" placeholder="timmar" />
          </div>
        </label>

        <!-- Rad 6: Dagboksanteckning -->
        <label class="full-width">Dagboksanteckning
          <textarea id="noteInput" rows="2"></textarea>
        </label>
      </div>

      <div class="button-row">
        <button class="btn" id="saveEntryBtn">
          <i data-lucide="plus-circle"></i>
          <span id="saveEntryLabel">Lägg till</span>
        </button>
        <button class="btn secondary" id="manualBackupBtn2">
          <i data-lucide="upload-cloud"></i>
          <span>Backup nu</span>
        </button>
        <button class="btn secondary" id="cancelEditBtn" style="display:none;">
          <i data-lucide="x-circle"></i>
          <span>Avbryt</span>
        </button>
      </div>
    </section>

    <!-- MÅNADSVY -->
    <section class="table-wrap">
      <table id="monthTable">
        <thead>
          <tr>
            <th>Datum</th>
            <th>Projekt</th>
            <th>Kategori</th>
            <th>Tid (h)</th>
            <th>Körtid (h)</th>
            <th>Dagboksanteckning</th>
            <th>Åtgärd</th>
          </tr>
        </thead>
        <tbody id="monthTableBody"></tbody>
        <tfoot>
          <tr>
            <td colspan="7" id="monthSummaryCell"></td>
          </tr>
        </tfoot>
      </table>
    </section>

    <!-- LARM / OBALANS -->
    <section class="alarm-card">
      <h3><i data-lucide="alert-triangle"></i> Larm / Obalans denna månad</h3>
      <div id="alarmContainer" class="alarm-empty">Inga avvikelser registrerade.</div>
    </section>

    <!-- ÅRSÖVERSIKT -->
    <section class="year-card">
      <h3>Årsöversikt</h3>
      <table id="yearTable">
        <thead>
          <tr>
            <th>Månad</th>
            <th>Ordinarie</th>
            <th>Körtid</th>
            <th>Flex</th>
            <th>ÖT &lt;2</th>
            <th>ÖT &gt;2 / Helg</th>
            <th>Semester</th>
            <th>ATF</th>
            <th>VAB</th>
            <th>Sjuk</th>
            <th>FL</th>
            <th>Trakt</th>
          </tr>
        </thead>
        <tbody id="yearTableBody"></tbody>
      </table>
    </section>

  </main>
</div>

<!-- Popup för varningar -->
<div id="warnPopup">
  <strong><i data-lucide="alert-triangle"></i></strong>
  <span id="warnPopupText"></span>
</div>

<!-- SCRIPT-ORDNING VIKTIG -->
<script src="balansregler.js"></script>
<script src="backup.js"></script>
<script src="export.js"></script>
<script src="search.js"></script>
<script src="app.js"></script>
<script>
  if(window.lucide){ lucide.createIcons(); }
</script>
</body>
</html>