<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tidrapport</title>
<meta name="theme-color" content="#0e6677" />
<link rel="icon" href="icon-512.png" />
<link rel="manifest" href="manifest.json" />

<!-- jsPDF fÃ¶r PDF-export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" referrerpolicy="no-referrer"></script>

<style>
:root{
  --brand:#0e6677;--bg:#f6f7f9;--card:#fff;--text:#1f2937;
  --muted:#6b7280;--danger:#b91c1c;--line:#e5e7eb;--accent:#0a515f;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}

/* Header */
header{position:sticky;top:0;z-index:30;background:var(--brand);color:#fff;display:flex;align-items:center;gap:.75rem;padding:.85rem 1rem}
.hamb,.helpbtn{width:40px;height:40px;border-radius:.6rem;background:var(--accent);border:none;color:#fff;font-size:1.1rem;display:grid;place-items:center;cursor:pointer}
header h1{margin:0;font-size:1.2rem;letter-spacing:.2px;flex:1}

/* Layout & Cards */
main{max-width:1100px;margin:0 auto;padding:1rem;display:grid;gap:1rem}
.card{background:var(--card);border:1px solid var(--line);border-radius:.9rem;box-shadow:0 1px 2px rgba(0,0,0,.04);padding:1rem}
.grid{display:grid;gap:.75rem}
@media(min-width:760px){.grid{grid-template-columns:repeat(6,1fr)}}
label{font-size:.85rem;color:var(--muted);display:block;margin-bottom:.2rem}
input,select,textarea,button{font-size:1rem}
input,select,textarea{width:100%;padding:.6rem .7rem;border:1px solid #cbd5e1;border-radius:.6rem;background:#fff}
textarea{min-height:42px;resize:vertical}
.actions{display:flex;gap:.5rem;flex-wrap:wrap}
.btn{border:0;border-radius:.6rem;padding:.55rem .8rem;font-weight:600;cursor:pointer}
.btn.primary{background:var(--brand);color:#fff}
.btn.ghost{background:#eef2f7}
.btn.danger{background:var(--danger);color:#fff}

/* Tabell */
table{width:100%;border-collapse:collapse;font-size:.95rem}
th,td{padding:.55rem;border-bottom:1px solid var(--line);text-align:left;vertical-align:top}
th{font-size:.78rem;color:var(--muted);text-transform:uppercase;letter-spacing:.4px}
tr.warn td{background:#fff7ed}
tr.weekend td{background:#f3f4f6}
tr.holiday td{background:#ffeef0}
tfoot td{background:#f0f9ff;font-weight:700}
.small{font-size:.85rem;color:var(--muted)}

/* Larm-pillars */
.pill{display:inline-flex;align-items:center;gap:.4rem;font-size:.85rem;border-radius:.5rem;padding:.15rem .5rem;font-weight:600;width:max-content}
.pill .dot{width:.55rem;height:.55rem;border-radius:999px;display:inline-block}
.pill.red{background:#fee2e2;color:#7f1d1d}
.pill.orange{background:#ffedd5;color:#7c2d12}
.pill.green{background:#dcfce7;color:#065f46}
.pill.blue{background:#dbeafe;color:#1e3a8a}
.pill.rose{background:#ffe4e6;color:#9f1239}
#alarms .pills{display:grid;gap:.25rem}

/* Meny (vÃ¤nster) */
aside#menu{
  position:fixed;top:0;left:0;width:min(420px,92%);height:100%;
  background:var(--card);border-right:1px solid var(--line);
  transform:translateX(-100%);transition:.25s ease;z-index:200;overflow:auto
}
aside#menu.open{transform:translateX(0)}
details summary{cursor:pointer}

/* HjÃ¤lp â€“ overlay */
#helpOverlay{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;z-index:300}
#helpOverlay.open{display:block}
.help-panel{
  position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
  width:min(920px,92%);max-height:84vh;overflow:auto;
  background:#fff;border:1px solid var(--line);border-radius:12px;padding:1rem 1rem 1.2rem;
  box-shadow:0 20px 60px rgba(0,0,0,.25)
}
.help-head{display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--line);padding:.3rem 0 .6rem}
.help-close{border:0;background:#eef2f7;border-radius:.6rem;width:38px;height:38px;cursor:pointer;font-size:1rem}
.section-title{display:flex;align-items:center;gap:.5rem;margin:.7rem 0;font-size:1.05rem}
.section-title .badge{display:inline-grid;place-items:center;width:28px;height:28px;border-radius:8px;background:#eef2f7;color:#111}
.list{display:grid;gap:.5rem}
.row{display:grid;grid-template-columns:28px 1fr;gap:.6rem;align-items:start}
.ico{width:28px;height:28px;border-radius:8px;display:grid;place-items:center;background:#eef2f7;color:#111;font-size:1rem;user-select:none}
hr.sep{border:0;border-top:1px dashed var(--line);margin:.8rem 0}

/* Utskrift */
@media print{ header,aside,#helpOverlay{display:none!important} }
</style>
</head>
<body>
<header>
  <button class="hamb" aria-label="Meny" onclick="toggleMenu(true)">â˜°</button>
  <h1>Tidrapport</h1>
  <button class="helpbtn" aria-label="HjÃ¤lp" onclick="openHelp()">?</button>
</header>

<main>
  <!-- Inmatning -->
  <div class="card">
    <div class="grid">
      <div><label for="datum">Datum</label><input type="date" id="datum" /></div>
      <div><label for="kategori">Kategori</label>
        <select id="kategori">
          <option>Ordinarie tid</option><option>Semester-tim</option><option>ATF-tim</option>
          <option>Sjuk-tim</option><option>FÃ¶rÃ¤ldraledig</option><option>VAB</option>
          <option>Flextid</option><option>Ã–vertid <2</option><option>Ã–vertid 2></option>
          <option>Ã–vertid-Helg</option><option>Traktamente</option>
        </select>
      </div>
      <div><label for="tid">Tid</label><input id="tid" type="text" inputmode="numeric" placeholder="0,25-steg â€“ minus tillÃ¥tet" /></div>
      <div><label for="projekt">Projekt nr</label><input id="projekt" placeholder="BokstÃ¤ver/siffror (inga mellanslag)" /></div>
      <div><label for="kortid">KÃ¶rtid</label><input id="kortid" type="text" inputmode="numeric" placeholder="0,25-steg â€“ minus tillÃ¥tet" /></div>
      <div><label for="beskrivning">Beskrivning</label><input id="beskrivning" placeholder="Fritext" /></div>
    </div>
    <div class="actions" style="margin-top:.6rem">
      <button class="btn primary" id="btnAdd">LÃ¤gg till</button>
      <button class="btn ghost" id="btnBackup">GÃ¶r backup</button>
      <button class="btn ghost" id="btnCancel" style="display:none">Avbryt</button>
    </div>
  </div>

  <!-- Tabell -->
  <div class="card">
    <table>
      <thead><tr><th>Datum</th><th>Projekt</th><th>Kategori</th><th>Tid</th><th>KÃ¶rtid</th><th>Beskrivning</th><th>Ã…tgÃ¤rd</th></tr></thead>
      <tbody id="rows"></tbody>
      <tfoot><tr><td colspan="7" id="totalsCell">Summering visas hÃ¤râ€¦</td></tr></tfoot>
    </table>
  </div>

  <!-- Larm & kontroller -->
  <div class="card">
    <strong>Larm & kontroller</strong>
    <div id="alarms" class="small">Inga varningar.</div>
    <div class="small" style="margin-top:.5rem">
      <span class="pill blue"><span class="dot"></span>Helg</span>
      <span class="pill rose"><span class="dot"></span>RÃ¶d dag</span>
      <span class="pill orange"><span class="dot"></span>Vardag &lt; 8h (Ord)</span>
      <span class="pill red"><span class="dot"></span>Saknas</span>
      <span class="pill green"><span class="dot"></span>OK</span>
    </div>
  </div>

  <!-- Ã…rsÃ¶versikt -->
  <div class="card">
    <strong>Ã…rsÃ¶versikt</strong>
    <div style="overflow:auto">
      <table>
        <thead>
          <tr>
            <th>MÃ¥nad</th><th>Ordinarie</th><th>Semester</th><th>ATF</th><th>Sjuk</th><th>FÃ¶rÃ¤ldraledig</th>
            <th>VAB</th><th>Flextid</th><th>Ã–T&lt;2</th><th>Ã–T2&gt;</th><th>Ã–T-Helg</th><th>Trakt (st)</th><th>KÃ¶rtid</th>
          </tr>
        </thead>
        <tbody id="yearBody"></tbody>
      </table>
    </div>
  </div>
</main>

<!-- Meny (vÃ¤nster, klick utanfÃ¶r stÃ¤nger) -->
<aside id="menu" onclick="if(event.target.id==='menu')toggleMenu(false)">
  <div style="padding:1rem;border-bottom:1px solid #ddd;display:flex;justify-content:space-between;align-items:center">
    <strong>â˜° Meny</strong>
    <button class="hamb" onclick="toggleMenu(false)">âœ•</button>
  </div>
  <div style="padding:1rem;display:grid;gap:1rem">

    <details open>
      <summary>ğŸ“… MÃ¥nad</summary>
      <div class="content" style="margin-top:.5rem;display:grid;gap:.5rem">
        <select id="menuMonth" class="select"></select>
        <div class="actions">
          <button class="btn ghost menu-btn" onclick="changeMonth()">Byt mÃ¥nad</button>
          <button class="btn ghost menu-btn" onclick="prevYear()">â—€ï¸ FÃ¶reg. Ã¥r</button>
          <button class="btn ghost menu-btn" onclick="nextYear()">NÃ¤sta Ã¥r â–¶ï¸</button>
        </div>
      </div>
    </details>

    <details>
      <summary>âš™ï¸ InstÃ¤llningar</summary>
      <div class="content" style="margin-top:.5rem;display:grid;gap:.5rem">
        <label>FÃ¶retag<input id="cfgCompany" /></label>
        <label>Namn<input id="cfgName" placeholder="FÃ¶r- och efternamn" /></label>
        <label>Anst-Nr<input id="cfgEmp" /></label>
        <label>Ã„gar-ID<input id="cfgOwner" placeholder="t.ex. martin, mm, anna-l" /></label>
        <label>Ã…r<input id="cfgYear" inputmode="numeric" placeholder="t.ex. 2025" /></label>
        <label>Extra notering<textarea id="cfgNote"></textarea></label>

        <label style="display:flex;gap:.5rem;align-items:center">
          <input type="checkbox" id="cfgAutoBackup" checked /> Automatisk lokal backup
        </label>

        <div class="actions">
          <button class="btn ghost" onclick="quickBackup()">GÃ¶r backup</button>
          <button class="btn ghost" onclick="saveSettings()">Spara</button>
          <button class="btn danger" onclick="resetSettings()">Rensa instÃ¤llningar</button>
          <button class="btn danger" onclick="resetAll()">Rensa all data</button>
        </div>

        <div class="actions">
          <button class="btn ghost" onclick="createYear()">Skapa nytt Ã¥r</button>
          <button class="btn danger" onclick="deleteYear()">Ã…terstÃ¤ll till nuvarande Ã¥r</button>
        </div>
      </div>
    </details>

    <details>
      <summary>ğŸ“¤ Exportera</summary>
      <div class="content" style="margin-top:.5rem;display:grid;gap:.5rem">
        <button class="btn ghost menu-btn" onclick="exportMonthReport()">Export MÃ¥nadsrapport (CSV)</button>
        <button class="btn ghost menu-btn" onclick="exportYearReportCombined()">Export Ã…rsrapport (CSV)</button>
        <button class="btn ghost menu-btn" onclick="exportExcelStyleMonth()">Export Excel-stil â€“ mÃ¥nad</button>
      </div>
    </details>

    <details>
      <summary>ğŸ”— Dela</summary>
      <div class="content" style="margin-top:.5rem;display:grid;gap:.5rem">
        <button class="btn ghost menu-btn" onclick="shareMonthReport()">Dela â€“ MÃ¥nadsrapport (CSV)</button>
        <button class="btn ghost menu-btn" onclick="shareYearReport()">Dela â€“ Ã…rsrapport (CSV)</button>
        <hr class="sep" style="border:0;border-top:1px dashed #e5e7eb">
        <button class="btn ghost menu-btn" onclick="shareMonthPdfEmail()">Dela som PDF â€“ MÃ¥nadsrapport (mail)</button>
        <button class="btn ghost menu-btn" onclick="shareYearPdfEmail()">Dela som PDF â€“ Ã…rsrapport (mail)</button>
        <hr class="sep" style="border:0;border-top:1px dashed #e5e7eb">
        <button class="btn ghost menu-btn" onclick="createEmlDraft()">Skapa e-postutkast (.eml)</button>
      </div>
    </details>

    <details>
      <summary>â¬†ï¸ Import/Backup</summary>
      <div class="content" style="margin-top:.5rem;display:grid;gap:.5rem">
        <div class="small">CSV: fÃ¶rsta rad <code>sep=;</code> + rubriker.</div>
        <input type="file" id="fileImport" accept=".csv" onchange="importCSV(event)" />
        <div class="small" style="margin-top:.5rem">Backup JSON:</div>
        <button class="btn ghost menu-btn" onclick="exportJSON()">Exportera backup (JSON)</button>
        <input type="file" id="fileJson" accept="application/json" onchange="importJSON(event)" />
        <button class="btn ghost menu-btn" onclick="shareJSON()">Dela (mobil) â€“ JSON</button>
      </div>
    </details>

    <details>
      <summary>ğŸ“˜ Manual / HjÃ¤lp</summary>
      <div class="content" style="margin-top:.5rem">
        <button class="btn ghost" onclick="openHelp()">Visa HjÃ¤lp</button>
      </div>
    </details>

    <div class="small" style="text-align:center">
      <hr class="sep" style="border:0;border-top:1px dashed #e5e7eb">
      ğŸ”¨ Tillverkad i samarbete med <strong>ChatGPT & Martin Mattsson</strong>
    </div>
  </div>
</aside>

<!-- HjÃ¤lp: overlay-panel -->
<div id="helpOverlay" onclick="if(event.target.id==='helpOverlay') closeHelp()">
  <div class="help-panel" role="dialog" aria-modal="true" aria-labelledby="helpTitle">
    <div class="help-head">
      <strong id="helpTitle">ğŸ“˜ HjÃ¤lp / Manual</strong>
      <button class="help-close" onclick="closeHelp()">âœ•</button>
    </div>
    <div class="help-body">
      <div class="section-title"><span class="badge">ğŸ§­</span><strong>SÃ¥ hÃ¤r anvÃ¤nder du Tidrapport</strong></div>
      <div class="list">
        <div class="row"><div class="ico">ğŸ“…</div><div><strong>VÃ¤lj datum</strong><br><span class="small">BÃ¶rja med att vÃ¤lja rÃ¤tt dag.</span></div></div>
        <div class="row"><div class="ico">ğŸ·ï¸</div><div><strong>VÃ¤lj kategori</strong><br><span class="small">T.ex. Ordinarie tid, Flextid, Ã–vertid &lt;2, Traktamente m.fl.</span></div></div>
        <div class="row"><div class="ico">â±ï¸</div><div><strong>Tid & kÃ¶rtid</strong><br><span class="small">0,25-steg. <em>Minus tillÃ¥tet</em> â€“ bevaras i export och summeringar.</span></div></div>
        <div class="row"><div class="ico">ğŸ“¦</div><div><strong>Projekt & beskrivning</strong><br><span class="small">Projekt endast bokstÃ¤ver/siffror (inga mellanslag). Beskrivning Ã¤r fri text.</span></div></div>
        <div class="row"><div class="ico">â•</div><div><strong>LÃ¤gg till</strong><br><span class="small">Raden hamnar i tabellen â€“ du kan <em>Ã„ndra</em> eller <em>Ta bort</em> nÃ¤r som helst.</span></div></div>
        <div class="row"><div class="ico">âš ï¸</div><div><strong>Larm & kontroller</strong><br><span class="small"><em>Enbart Ordinarie tid</em> rÃ¤knas mot 8h. Flex/Ã–T pÃ¥verkar inte 8h-regeln.</span></div></div>
        <div class="row"><div class="ico">ğŸ“Š</div><div><strong>Ã…rsÃ¶versikt</strong><br><span class="small">Summeringar per mÃ¥nad, kÃ¶rtid och traktamente (0 visas tomt).</span></div></div>
        <div class="row"><div class="ico">ğŸ“¤</div><div><strong>Export (CSV/PDF)</strong><br><span class="small">CSV med metadata, RADER, SUMMA och SUMMERING PER PROJEKT. PDF motsvarar CSV-innehÃ¥llet.</span></div></div>
        <div class="row"><div class="ico">â˜ï¸</div><div><strong>Backup</strong><br><span class="small">Exportera/Importera JSON. Web Share fungerar pÃ¥ mobil.</span></div></div>
      </div>
      <hr class="sep">
      <div class="section-title"><span class="badge">ğŸ“²</span><strong>Installera som app (PWA)</strong></div>
      <div class="list">
        <div class="row"><div class="ico">ğŸ¤–</div><div><strong>Android/Chrome</strong><br><span class="small">Meny â‹® â†’ â€Installera appâ€ eller â€LÃ¤gg till pÃ¥ startskÃ¤rmenâ€.</span></div></div>
        <div class="row"><div class="ico">ğŸ</div><div><strong>iOS/Safari</strong><br><span class="small">Dela â†’ â€LÃ¤gg till pÃ¥ hemskÃ¤rmenâ€.</span></div></div>
      </div>
      <hr class="sep">
      <div class="row"><div class="ico">â—</div><div><strong>Ansvarsfriskrivning</strong><br><span class="small">Du ansvarar sjÃ¤lv fÃ¶r att spara/hantera backuper korrekt. Utvecklaren tar inget ansvar fÃ¶r datafÃ¶rlust utanfÃ¶r appens kontroll.</span></div></div>
    </div>
  </div>
</div>

<script src="app.js"></script>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js").catch(err=>console.error("SW fail:", err));
}
</script>
</body>
</html>
