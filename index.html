<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Tidrapport</title>

<!-- PWA / App-ikon -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0e6677">
<link rel="icon" href="icon-512.png">

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" referrerpolicy="no-referrer"></script>

<link rel="stylesheet" href="style.css">
</head>
<body>
<header>
  <button class="hamb" aria-label="Meny" onclick="toggleMenu(true)">â˜°</button>
  <h1>Tidrapport</h1>
</header>

<main>
  <div class="card"><strong id="monthTitle">Tidrapport</strong></div>

  <!-- FormulÃ¤r -->
  <div class="card">
    <div class="grid">
      <div><label for="datum">Datum</label><input type="date" id="datum"></div>
      <div><label for="kategori">Kategori</label>
        <select id="kategori">
          <option>Ordinarie tid</option><option>Semester-tim</option><option>ATF-tim</option>
          <option>Sjuk-tim</option><option>FÃ¶rÃ¤ldraledig</option><option>VAB</option>
          <option>Flextid</option><option>Ã–vertid &lt;2</option><option>Ã–vertid 2&gt;</option>
          <option>Ã–vertid-Helg</option><option>Traktamente</option>
        </select>
      </div>
      <div><label for="tid">Tid</label><input id="tid" type="text" inputmode="numeric"></div>
      <div><label for="projekt">Projekt nr</label><input id="projekt"></div>
      <div><label for="kortid">KÃ¶rtid</label><input id="kortid" type="text" inputmode="numeric"></div>
      <div><label for="beskrivning">Beskrivning</label><input id="beskrivning"></div>
    </div>
    <div class="actions" style="margin-top:.6rem">
      <button class="btn primary" id="btnAdd">LÃ¤gg till</button>
      <button class="btn ghost" id="btnBackup">GÃ¶r backup</button>
      <button class="btn ghost" id="btnCancel" style="display:none">Avbryt</button>
    </div>
  </div>

  <!-- Tabell -->
  <div class="card">
    <table>
      <thead><tr><th>Datum</th><th>Projekt</th><th>Kategori</th><th>Tid</th><th>KÃ¶rtid</th><th>Beskrivning</th><th>Ã…tgÃ¤rd</th></tr></thead>
      <tbody id="rows"></tbody>
      <tfoot><tr><td colspan="7" id="totalsCell">Summering visas hÃ¤râ€¦</td></tr></tfoot>
    </table>
  </div>

  <!-- Larm & kontroller -->
  <div class="card">
    <strong>Larm & kontroller</strong>
    <div id="alarms" class="small">Inga varningar.</div>
    <div id="alarmsLegend" class="small" style="margin-top:.5rem">
      <div class="legend">
        <span class="pill red"><span class="dot"></span>Saknas</span>
        <span class="pill orange"><span class="dot"></span>Under 8h</span>
        <span class="pill green"><span class="dot"></span>OK</span>
        <span class="pill blue"><span class="dot"></span>Helg</span>
        <span class="pill rose"><span class="dot"></span>RÃ¶d dag</span>
      </div>
    </div>
  </div>

  <!-- Ã…rsÃ¶versikt -->
  <div class="card">
    <strong>Ã…rsÃ¶versikt</strong>
    <div id="yearLinks" style="margin:.5rem 0;"></div>
    <div style="overflow:auto">
      <table>
        <thead>
          <tr>
            <th>MÃ¥nad</th><th>Ordinarie</th><th>Semester</th><th>ATF</th><th>Sjuk</th><th>FÃ¶rÃ¤ldraledig</th>
            <th>VAB</th><th>Flextid</th><th>Ã–T&lt;2</th><th>Ã–T2&gt;</th><th>Ã–T-Helg</th><th>Trakt (st)</th><th>KÃ¶rtid</th>
          </tr>
        </thead>
        <tbody id="yearBody"></tbody>
      </table>
    </div>
  </div>

  <div id="printRoot" style="display:none"></div>
</main>

<!-- Overlay & Meny -->
<div id="menuOverlay" onclick="toggleMenu(false)"></div>
<aside id="menu" aria-hidden="true">
  <div class="menu-head">
    <strong>Meny</strong>
    <button class="hamb" onclick="toggleMenu(false)" aria-label="StÃ¤ng">âœ•</button>
  </div>
  <div class="menu-body">
    <details class="group" open>
      <summary>MÃ¥nad</summary>
      <div class="content">
        <select id="menuMonth" class="select"></select>
        <button class="btn ghost menu-btn" onclick="changeMonth()">Byt mÃ¥nad</button>
      </div>
    </details>

    <details class="group">
      <summary>InstÃ¤llningar</summary>
      <div class="content">
        <label>FÃ¶retag<input id="cfgCompany"></label>
        <label>Namn<input id="cfgName"></label>
        <label>Anst-Nr<input id="cfgEmp"></label>
        <label>Ã„gar-ID<input id="cfgOwner"></label>
        <label>Ã…r<input id="cfgYear" inputmode="numeric"></label>
        <label>Notering<textarea id="cfgNote"></textarea></label>
        <label><input type="checkbox" id="cfgAutoBackup" checked> Auto-backup</label>
        <div class="actions">
          <button class="btn ghost" onclick="saveSettings()">Spara</button>
          <button class="btn danger" onclick="resetAll()">Rensa all data</button>
        </div>
      </div>
    </details>

    <details class="group">
      <summary>Exportera</summary>
      <div class="content">
        <button class="btn ghost menu-btn" onclick="exportMonthReport()">Export MÃ¥nadsrapport (CSV)</button>
        <button class="btn ghost menu-btn" onclick="exportYearReportCombined()">Export Ã…rsrapport (CSV)</button>
      </div>
    </details>

    <details class="group">
      <summary>Dela</summary>
      <div class="content">
        <button class="btn ghost menu-btn" onclick="shareMonthReport()">Dela â€“ MÃ¥nadsrapport (CSV)</button>
        <button class="btn ghost menu-btn" onclick="shareYearReport()">Dela â€“ Ã…rsrapport (CSV)</button>
        <button class="btn ghost menu-btn" onclick="shareMonthPdfEmail()">Dela som PDF â€“ MÃ¥nad</button>
        <button class="btn ghost menu-btn" onclick="shareYearPdfEmail()">Dela som PDF â€“ Ã…r</button>
      </div>
    </details>

    <details class="group">
      <summary>Import/Backup</summary>
      <div class="content">
        <input type="file" id="fileImport" accept=".csv" onchange="importCSV(event)">
        <button class="btn ghost menu-btn" onclick="exportJSON()">Exportera backup (JSON)</button>
        <input type="file" id="fileJson" accept="application/json" onchange="importJSON(event)">
        <button class="btn ghost menu-btn" onclick="shareJSON()">Dela (mobil) â€“ JSON</button>
      </div>
    </details>

    <div class="small" style="text-align:center">
      <hr class="sep">
      ðŸ”¨ Byggd i samarbete med <strong>ChatGPT & Martin Mattsson</strong>
    </div>
  </div>
</aside>

<script src="app.js"></script>
<script>
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js').catch(err=>console.warn("SW fail",err));
}
</script>
</body>
</html>