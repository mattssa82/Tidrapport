<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Tidrapport</title>
  <meta name="theme-color" content="#0e6677" />
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icon-512.png" />

  <!-- jsPDF fÃ¶r PDF-export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" referrerpolicy="no-referrer"></script>

  <style>
    :root{
      --brand:#0e6677; --accent:#0a515f; --bg:#f6f7f9; --card:#fff;
      --text:#1f2937; --muted:#6b7280; --line:#e5e7eb; --danger:#b91c1c;
      --ok:#16a34a; --warn:#b45309; --blue:#1e3a8a; --rose:#9f1239;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    header{position:sticky;top:0;z-index:30;background:var(--brand);color:#fff;display:flex;align-items:center;gap:.75rem;padding:.85rem 1rem}
    .hamb,.helpbtn{width:40px;height:40px;border-radius:.6rem;background:var(--accent);border:none;color:#fff;font-size:1.1rem;display:grid;place-items:center;cursor:pointer}
    header h1{margin:0;font-size:1.2rem;letter-spacing:.2px;flex:1}
    main{max-width:1100px;margin:0 auto;padding:1rem;display:grid;gap:1rem}
    .card{background:var(--card);border:1px solid var(--line);border-radius:.9rem;box-shadow:0 1px 2px rgba(0,0,0,.04);padding:1rem}
    .grid{display:grid;gap:.75rem}
    @media(min-width:760px){.grid{grid-template-columns:repeat(6,1fr)}}
    label{font-size:.85rem;color:var(--muted);display:block;margin-bottom:.2rem}
    input,select,textarea,button{font-size:1rem}
    input,select,textarea{width:100%;padding:.6rem .7rem;border:1px solid #cbd5e1;border-radius:.6rem;background:#fff}
    textarea{min-height:42px;resize:vertical}
    .actions{display:flex;gap:.5rem;flex-wrap:wrap}
    .btn{border:0;border-radius:.6rem;padding:.55rem .8rem;font-weight:600;cursor:pointer}
    .btn.primary{background:var(--brand);color:#fff}
    .btn.ghost{background:#eef2f7}
    .btn.danger{background:var(--danger);color:#fff}
    table{width:100%;border-collapse:collapse;font-size:.95rem}
    th,td{padding:.55rem;border-bottom:1px solid var(--line);text-align:left;vertical-align:top}
    th{font-size:.78rem;color:var(--muted);text-transform:uppercase;letter-spacing:.4px}
    tr.warn td{background:#fff7ed}
    tr.weekend td{background:#f3f4f6}
    tr.holiday td{background:#ffeef0}
    tfoot td{background:#f0f9ff;font-weight:700}
    .small{font-size:.85rem;color:var(--muted)}
    .pill{display:inline-flex;align-items:center;gap:.4rem;font-size:.85rem;border-radius:.5rem;padding:.15rem .5rem;font-weight:600;width:max-content}
    .pill .dot{width:.55rem;height:.55rem;border-radius:999px;display:inline-block}
    .pill.red{background:#fee2e2;color:#7f1d1d}
    .pill.orange{background:#ffedd5;color:#7c2d12}
    .pill.green{background:#dcfce7;color:#065f46}
    .pill.blue{background:#dbeafe;color:#1e3a8a}
    .pill.gray{background:#e5e7eb;color:#374151}
    #alarms .pills{display:grid;gap:.25rem}
    aside#menu{
      position:fixed;top:0;left:0;width:min(420px,92%);height:100%;
      background:var(--card);border-right:1px solid var(--line);
      transform:translateX(-100%);transition:.25s ease;z-index:200;overflow:auto
    }
    aside#menu.open{transform:translateX(0)}
    details{border-top:1px dashed var(--line);padding:.6rem 1rem}
    details:first-of-type{border-top:0}
    details summary{cursor:pointer;display:flex;align-items:center;gap:.5rem;font-weight:700}
    .sub{display:grid;gap:.5rem;padding:.6rem 0 .2rem 1.6rem}
    .sub button,.sub label{display:flex;align-items:center;gap:.5rem}
    .icon{font-size:1.05rem;display:inline-grid;place-items:center;width:24px;height:24px;border-radius:.5rem;background:#eef2f7}
    #helpOverlay{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;z-index:300}
    #helpOverlay.open{display:block}
    .help-panel{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
      width:min(920px,92%);max-height:84vh;overflow:auto;background:#fff;border:1px solid var(--line);border-radius:12px;padding:1rem;box-shadow:0 20px 60px rgba(0,0,0,.25)}
    .help-head{display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--line);padding:.3rem 0 .6rem}
    .help-close{border:0;background:#eef2f7;border-radius:.6rem;width:38px;height:38px;cursor:pointer;font-size:1rem}
    footer{padding:1rem;text-align:center;color:var(--muted)}
    @media print{ header,aside,#helpOverlay{display:none!important} }
  </style>
</head>
<body>
  <header>
    <button class="hamb" aria-label="Meny" id="menuBtn" onclick="toggleMenu(true)">â˜°</button>
    <h1>Tidrapport</h1>
    <button class="helpbtn" aria-label="HjÃ¤lp" onclick="location.href='help.html'">â„¹ï¸</button>
  </header>

  <main>
    <!-- Inmatning -->
    <div class="card" id="entryCard">
      <div class="grid">
        <div><label for="datum">ğŸ“… Datum</label><input type="date" id="datum" /></div>
        <div><label for="kategori">ğŸ·ï¸ Kategori</label>
          <select id="kategori">
            <option>Ordinarie</option><option>Flextid</option><option>ATF-tim</option>
            <option>Semester-tim</option><option>Sjuk-tim</option><option>FÃ¶rÃ¤ldraledig</option><option>VAB</option>
            <option>Ã–vertid <2</option><option>Ã–vertid 2></option><option>Ã–vertid-Helg</option><option>Traktamente</option>
          </select>
        </div>
        <div><label for="tid">â±ï¸ Tid</label><input id="tid" type="text" inputmode="numeric" /></div>
        <div><label for="projekt">ğŸ“¦ Projekt</label><input id="projekt" /></div>
        <div><label for="kortid">ğŸš— KÃ¶rtid</label><input id="kortid" type="text" inputmode="numeric" /></div>
        <div><label for="beskrivning">ğŸ“ Beskrivning</label><input id="beskrivning" /></div>
      </div>
      <div class="actions" style="margin-top:.6rem">
        <button class="btn primary" id="btnAdd">LÃ¤gg till</button>
        <button class="btn ghost" id="btnBackup">GÃ¶r backup</button>
        <button class="btn ghost" id="btnCancel" style="display:none">Avbryt</button>
      </div>
    </div>

    <!-- Tabell -->
    <div class="card">
      <table>
        <thead>
          <tr><th>Datum</th><th>Projekt</th><th>Kategori</th><th>Tid</th><th>KÃ¶rtid</th><th>Beskrivning</th><th>Ã…tgÃ¤rd</th></tr>
        </thead>
        <tbody id="rows"></tbody>
        <tfoot><tr><td colspan="7" id="totalsCell">Summering visas hÃ¤râ€¦</td></tr></tfoot>
      </table>
    </div>

    <!-- Larm & kontroller -->
    <div class="card">
      <strong>Larm & kontroller</strong>
      <div id="alarms" class="small">Inga varningar.</div>
    </div>

    <!-- Ã…rsÃ¶versikt -->
    <div class="card" id="yearCard">
      <strong>Ã…rsÃ¶versikt</strong>
      <div style="overflow:auto">
        <table>
          <thead>
            <tr>
              <th>MÃ¥nad</th><th>Ordinarie</th><th>Semester</th><th>ATF</th><th>Sjuk</th><th>FÃ¶rÃ¤ldraledig</th>
              <th>VAB</th><th>Flextid</th><th>Ã–T&lt;2</th><th>Ã–T2&gt;</th><th>Ã–T-Helg</th><th>Trakt (st)</th><th>KÃ¶rtid</th>
            </tr>
          </thead>
          <tbody id="yearBody"></tbody>
        </table>
      </div>
    </div>
  </main>

  <!-- Meny -->
  <aside id="menu" onclick="if(event.target.id==='menu')toggleMenu(false)">
    <div style="padding:1rem .75rem .75rem;font-weight:700;color:#111">Meny</div>

    <!-- MÃ¥nad -->
    <details open>
      <summary><span class="icon">ğŸ“…</span>MÃ¥nad</summary>
      <div class="sub">
        <label><span class="icon">ğŸ—“ï¸</span>
          <select id="menuMonth" onchange="changeMonth()" style="flex:1; padding:.5rem .6rem; border:1px solid var(--line); border-radius:.5rem"></select>
        </label>
        <button class="btn ghost" onclick="toggleMenu(false)"><span class="icon">â¡ï¸</span>Visa aktuell mÃ¥nad</button>
      </div>
    </details>

    <!-- Ã…r -->
    <details>
      <summary><span class="icon">ğŸ“†</span>Ã…r</summary>
      <div class="sub">
        <button class="btn ghost" onclick="toggleMenu(false); document.getElementById('yearCard').scrollIntoView({behavior:'smooth'});"><span class="icon">ğŸ“‹</span>GÃ¥ till Ã¥rsÃ¶versikt</button>
        <button class="btn ghost" onclick="createYear()"><span class="icon">â•</span>Skapa nytt Ã¥r</button>
        <button class="btn ghost" onclick="deleteYear()"><span class="icon">â™»ï¸</span>Ã…terstÃ¤ll till innevarande Ã¥r</button>
      </div>
    </details>

    <!-- SÃ¶k -->
    <details>
      <summary><span class="icon">ğŸ”</span>SÃ¶k</summary>
      <div class="sub">
        <button class="btn ghost" onclick="APP.openSearch()"><span class="icon">ğŸ”</span>Ã–ppna sÃ¶ksida</button>
      </div>
    </details>

    <!-- Export -->
    <details>
      <summary><span class="icon">ğŸ“¤</span>Export</summary>
      <div class="sub">
        <button class="btn ghost" onclick="exportMonthCSV()"><span class="icon">ğŸ“‘</span>MÃ¥nadsrapport (CSV)</button>
        <button class="btn ghost" onclick="exportYearCSV()"><span class="icon">ğŸ—“ï¸</span>Ã…rsrapport (CSV)</button>
        <button class="btn ghost" onclick="exportMonthPDF()"><span class="icon">ğŸ“</span>PDF mÃ¥nadsrapport</button>
        <button class="btn ghost" onclick="exportYearPDF()"><span class="icon">ğŸ“</span>PDF Ã¥rsrapport</button>
      </div>
    </details>

    <!-- Import / Backup -->
    <details>
      <summary><span class="icon">ğŸ“¥</span>Import / Backup</summary>
      <div class="sub">
        <label for="csvFile"><span class="icon">ğŸ“‘</span>Importera CSV</label>
        <input id="csvFile" type="file" accept=".csv" onchange="importCSV && importCSV(event)" />
        <label for="jsonFile"><span class="icon">â˜ï¸</span>LÃ¤s in backup (JSON)</label>
        <input id="jsonFile" type="file" accept=".json,application/json" onchange="importJSON(event)" />
        <button class="btn ghost" onclick="shareJSON && shareJSON()"><span class="icon">âš¡</span>Snabbbackup via Dela</button>
        <button class="btn ghost" onclick="exportJSON()"><span class="icon">ğŸ’¾</span>Exportera backup (JSON)</button>
      </div>
    </details>

    <!-- InstÃ¤llningar -->
    <details>
      <summary><span class="icon">âš™ï¸</span>InstÃ¤llningar</summary>
      <div class="sub">
        <label><span class="icon">ğŸ¢</span>FÃ¶retag<input id="cfgCompany" /></label>
        <label><span class="icon">ğŸ‘¤</span>Namn<input id="cfgName" /></label>
        <label><span class="icon">ğŸ†”</span>Anst-Nr<input id="cfgEmp" /></label>
        <label><span class="icon">ğŸ”‘</span>Ã„gar-ID<input id="cfgOwner" /></label>
        <label><span class="icon">ğŸ“…</span>Ã…r<input id="cfgYear" type="number" inputmode="numeric" /></label>
        <label><span class="icon">ğŸ“</span>Noteringar<textarea id="cfgNote"></textarea></label>
        <label style="align-items:center"><input id="cfgAutoBackup" type="checkbox" style="margin-right:.5rem" />Aktivera auto-backup</label>
        <label style="align-items:center"><input id="cfgHolidays" type="checkbox" checked style="margin-right:.5rem" onchange="APP.toggleHolidays(this.checked)" />Visa/hantera rÃ¶da dagar</label>
        <label><span class="icon">ğŸ¯</span>RÃ¶ddag standard (h)<input id="cfgHolidayHours" type="number" step="0.25" value="8" /></label>
        <div class="actions">
          <button class="btn primary" onclick="saveSettings()"><span class="icon">ğŸ’¾</span>Spara</button>
          <button class="btn ghost" onclick="resetSettings()"><span class="icon">ğŸ§¼</span>Rensa instÃ¤llningar</button>
        </div>
      </div>
    </details>

    <!-- Rensa -->
    <details>
      <summary><span class="icon">ğŸ§¹</span>Rensa</summary>
      <div class="sub">
        <button class="btn danger" onclick="resetAll()"><span class="icon">ğŸ—‘ï¸</span>RENSA ALLT</button>
      </div>
    </details>

    <!-- HjÃ¤lp -->
    <details>
      <summary><span class="icon">â„¹ï¸</span>HjÃ¤lp</summary>
      <div class="sub">
        <button class="btn ghost" onclick="location.href='help.html'"><span class="icon">ğŸ“˜</span>Ã–ppna manual</button>
      </div>
    </details>
  </aside>

  <!-- HjÃ¤lp-overlay (finns kvar fÃ¶r framtida, men vi lÃ¤nkar primÃ¤rt till help.html) -->
  <div id="helpOverlay" onclick="if(event.target.id==='helpOverlay') closeHelp()">
    <div class="help-panel">
      <div class="help-head">
        <strong>ğŸ“˜ HjÃ¤lp / Manual</strong>
        <button class="help-close" onclick="closeHelp()">âœ•</button>
      </div>
      <div class="help-body">
        <p class="small">Manualen finns pÃ¥ egen sida. Klicka â„¹ï¸ uppe till hÃ¶ger eller Ã¶ppna via menyn.</p>
      </div>
    </div>
  </div>

  <footer>
    <p class="small">Tidrapport Â© 2025 â€“ byggd tillsammans med ChatGPT &amp; Martin Mattsson.</p>
  </footer>

  <!-- Script: ordning viktig -->
  <script src="export.js"></script>
  <script src="backup.js"></script>
  <script src="app.js"></script>
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("sw.js").catch(err=>console.error("SW fail:", err));
    }
  </script>
</body>
</html>